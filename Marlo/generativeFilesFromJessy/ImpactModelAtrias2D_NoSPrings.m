function [De,E]= ImpactModelAtrias2D_NoSPrings(qe,dqe)
%%%%%%  ImpactModelAtrias2D_NoSPrings.m
%%%%  29-Apr-2013 17:14:07
%%%%
%%%% Authors(s): Grizzle, (generated by BAG)
%%%%
%%%%
%%%% Model NOTATION: Spong and Vidyasagar, page 142, Eq. (6.3.12)
%%%%                 D(q)ddq + C(q,dq)*dq + G(q) = B*tau
%%%%
%%%%
[g mTotal L1 L2 L3 L4 m1 m2 m3 m4 Jcm1 Jcm2 Jcm3 Jcm4 ellzcm1 ...
         ellzcm2 ellzcm3 ellzcm4 ellycm1 ellycm2 ellycm3 ellycm4 LT mT ...
         JcmT ellzcmT ellycmT mH JcmH K1 K2 Kd1 Kd2 Jrotor1 Jrotor2 ...
         Jgear1  Jgear2 R1  R2] = modelParametersAtrias_v05;
%%%%
%%%%[g mTotal L1 L2 L3 L4 m1 m2 m3 m4 Jcm1 Jcm2 Jcm3 Jcm4 ellzcm1 ellzcm2 ellzcm3 ellzcm4 ellycm1 ellycm2 ellycm3 ellycm4 LT mT JcmT ellzcmT ellycmT mH JcmH K1 K2 Kd1 Kd2 Jrotor1 Jrotor2 Jgear1  Jgear2 R1  R2] = modelParametersAtrias_v05;
%%%%
%%%%
yLeg=qe(1);  dyLeg=dqe(1);
zLeg=qe(2);  dzLeg=dqe(2);
qT=qe(3);  dqT=dqe(3);
q1=qe(4);  dq1=dqe(4);
q2=qe(5);  dq2=dqe(5);
q1L=qe(6);  dq1L=dqe(6);
q2L=qe(7);  dq2L=dqe(7);
%%%%
%%%%
De=zeros(7,7);
De(1,1)=2*m1 + 2*m2 + 2*m3 + 2*m4 + mH + mT;
De(1,3)=2*L2*m1*cos(q2 + qT) - ellycmT*mT*sin(qT) - L1*m3*...
         cos(q1 + qT) - ellzcmT*mT*cos(qT) + 2*L2*m2*cos(q2 + qT) + 2*L4*...
         m1*cos(q1 + qT) + 2*L2*m3*cos(q2 + qT) + 2*L4*m2*...
         cos(q1 + qT) + L2*m4*cos(q2 + qT) + 2*L4*m3*cos(q1 + qT) + 2*L4*...
         m4*cos(q1 + qT) - L1*m3*cos(q1L + qT) - L2*m4*cos(q2L + qT) + L2*...
         mH*cos(q2 + qT) + L4*mH*cos(q1 + qT) + L2*mT*cos(q2 + qT) + L4*...
         mT*cos(q1 + qT) - ellzcm1*m1*cos(q1 + qT) - ellzcm2*m2*...
         cos(q2 + qT) - ellzcm3*m3*cos(q2 + qT) - ellzcm4*m4*...
         cos(q1 + qT) - ellzcm1*m1*cos(q1L + qT) - ellzcm2*m2*...
         cos(q2L + qT) - ellzcm3*m3*cos(q2L + qT) - ellzcm4*m4*...
         cos(q1L + qT) - ellycm1*m1*sin(q1 + qT) - ellycm2*m2*...
         sin(q2 + qT) - ellycm3*m3*sin(q2 + qT) - ellycm4*m4*...
         sin(q1 + qT) - ellycm1*m1*sin(q1L + qT) - ellycm2*m2*...
         sin(q2L + qT) - ellycm3*m3*sin(q2L + qT) - ellycm4*m4*...
         sin(q1L + qT);
De(1,4)=2*L4*m1*cos(q1 + qT) - L1*m3*cos(q1 + qT) + 2*L4*m2*...
         cos(q1 + qT) + 2*L4*m3*cos(q1 + qT) + 2*L4*m4*cos(q1 + qT) + L4*...
         mH*cos(q1 + qT) + L4*mT*cos(q1 + qT) - ellzcm1*m1*...
         cos(q1 + qT) - ellzcm4*m4*cos(q1 + qT) - ellycm1*m1*...
         sin(q1 + qT) - ellycm4*m4*sin(q1 + qT);
De(1,5)=2*L2*m1*cos(q2 + qT) + 2*L2*m2*cos(q2 + qT) + 2*L2*m3*...
         cos(q2 + qT) + L2*m4*cos(q2 + qT) + L2*mH*cos(q2 + qT) + L2*mT*...
         cos(q2 + qT) - ellzcm2*m2*cos(q2 + qT) - ellzcm3*m3*...
         cos(q2 + qT) - ellycm2*m2*sin(q2 + qT) - ellycm3*m3*sin(q2 + qT);
De(1,6)=- L1*m3*cos(q1L + qT) - ellzcm1*m1*...
         cos(q1L + qT) - ellzcm4*m4*cos(q1L + qT) - ellycm1*m1*...
         sin(q1L + qT) - ellycm4*m4*sin(q1L + qT);
De(1,7)=- L2*m4*cos(q2L + qT) - ellzcm2*m2*...
         cos(q2L + qT) - ellzcm3*m3*cos(q2L + qT) - ellycm2*m2*...
         sin(q2L + qT) - ellycm3*m3*sin(q2L + qT);
De(2,2)=2*m1 + 2*m2 + 2*m3 + 2*m4 + mH + mT;
De(2,3)=ellycmT*mT*cos(qT) - ellzcmT*mT*sin(qT) - L1*m3*...
         sin(q1 + qT) + 2*L2*m1*sin(q2 + qT) + 2*L2*m2*sin(q2 + qT) + 2*...
         L4*m1*sin(q1 + qT) + 2*L2*m3*sin(q2 + qT) + 2*L4*m2*...
         sin(q1 + qT) + L2*m4*sin(q2 + qT) + 2*L4*m3*sin(q1 + qT) + 2*L4*...
         m4*sin(q1 + qT) - L1*m3*sin(q1L + qT) - L2*m4*sin(q2L + qT) + L2*...
         mH*sin(q2 + qT) + L4*mH*sin(q1 + qT) + L2*mT*sin(q2 + qT) + L4*...
         mT*sin(q1 + qT) + ellycm1*m1*cos(q1 + qT) + ellycm2*m2*...
         cos(q2 + qT) + ellycm3*m3*cos(q2 + qT) + ellycm4*m4*...
         cos(q1 + qT) + ellycm1*m1*cos(q1L + qT) + ellycm2*m2*...
         cos(q2L + qT) + ellycm3*m3*cos(q2L + qT) + ellycm4*m4*...
         cos(q1L + qT) - ellzcm1*m1*sin(q1 + qT) - ellzcm2*m2*...
         sin(q2 + qT) - ellzcm3*m3*sin(q2 + qT) - ellzcm4*m4*...
         sin(q1 + qT) - ellzcm1*m1*sin(q1L + qT) - ellzcm2*m2*...
         sin(q2L + qT) - ellzcm3*m3*sin(q2L + qT) - ellzcm4*m4*...
         sin(q1L + qT);
De(2,4)=2*L4*m1*sin(q1 + qT) - L1*m3*sin(q1 + qT) + 2*L4*m2*...
         sin(q1 + qT) + 2*L4*m3*sin(q1 + qT) + 2*L4*m4*sin(q1 + qT) + L4*...
         mH*sin(q1 + qT) + L4*mT*sin(q1 + qT) + ellycm1*m1*...
         cos(q1 + qT) + ellycm4*m4*cos(q1 + qT) - ellzcm1*m1*...
         sin(q1 + qT) - ellzcm4*m4*sin(q1 + qT);
De(2,5)=2*L2*m1*sin(q2 + qT) + 2*L2*m2*sin(q2 + qT) + 2*L2*m3*...
         sin(q2 + qT) + L2*m4*sin(q2 + qT) + L2*mH*sin(q2 + qT) + L2*mT*...
         sin(q2 + qT) + ellycm2*m2*cos(q2 + qT) + ellycm3*m3*...
         cos(q2 + qT) - ellzcm2*m2*sin(q2 + qT) - ellzcm3*m3*sin(q2 + qT);
De(2,6)=ellycm1*m1*cos(q1L + qT) - L1*m3*sin(q1L + qT) + ellycm4*...
         m4*cos(q1L + qT) - ellzcm1*m1*sin(q1L + qT) - ellzcm4*m4*...
         sin(q1L + qT);
De(2,7)=ellycm2*m2*cos(q2L + qT) - L2*m4*sin(q2L + qT) + ellycm3*...
         m3*cos(q2L + qT) - ellzcm2*m2*sin(q2L + qT) - ellzcm3*m3*...
         sin(q2L + qT);
De(3,1)=2*L2*m1*cos(q2 + qT) - ellycmT*mT*sin(qT) - L1*m3*...
         cos(q1 + qT) - ellzcmT*mT*cos(qT) + 2*L2*m2*cos(q2 + qT) + 2*L4*...
         m1*cos(q1 + qT) + 2*L2*m3*cos(q2 + qT) + 2*L4*m2*...
         cos(q1 + qT) + L2*m4*cos(q2 + qT) + 2*L4*m3*cos(q1 + qT) + 2*L4*...
         m4*cos(q1 + qT) - L1*m3*cos(q1L + qT) - L2*m4*cos(q2L + qT) + L2*...
         mH*cos(q2 + qT) + L4*mH*cos(q1 + qT) + L2*mT*cos(q2 + qT) + L4*...
         mT*cos(q1 + qT) - ellzcm1*m1*cos(q1 + qT) - ellzcm2*m2*...
         cos(q2 + qT) - ellzcm3*m3*cos(q2 + qT) - ellzcm4*m4*...
         cos(q1 + qT) - ellzcm1*m1*cos(q1L + qT) - ellzcm2*m2*...
         cos(q2L + qT) - ellzcm3*m3*cos(q2L + qT) - ellzcm4*m4*...
         cos(q1L + qT) - ellycm1*m1*sin(q1 + qT) - ellycm2*m2*...
         sin(q2 + qT) - ellycm3*m3*sin(q2 + qT) - ellycm4*m4*...
         sin(q1 + qT) - ellycm1*m1*sin(q1L + qT) - ellycm2*m2*...
         sin(q2L + qT) - ellycm3*m3*sin(q2L + qT) - ellycm4*m4*...
         sin(q1L + qT);
De(3,2)=ellycmT*mT*cos(qT) - ellzcmT*mT*sin(qT) - L1*m3*...
         sin(q1 + qT) + 2*L2*m1*sin(q2 + qT) + 2*L2*m2*sin(q2 + qT) + 2*...
         L4*m1*sin(q1 + qT) + 2*L2*m3*sin(q2 + qT) + 2*L4*m2*...
         sin(q1 + qT) + L2*m4*sin(q2 + qT) + 2*L4*m3*sin(q1 + qT) + 2*L4*...
         m4*sin(q1 + qT) - L1*m3*sin(q1L + qT) - L2*m4*sin(q2L + qT) + L2*...
         mH*sin(q2 + qT) + L4*mH*sin(q1 + qT) + L2*mT*sin(q2 + qT) + L4*...
         mT*sin(q1 + qT) + ellycm1*m1*cos(q1 + qT) + ellycm2*m2*...
         cos(q2 + qT) + ellycm3*m3*cos(q2 + qT) + ellycm4*m4*...
         cos(q1 + qT) + ellycm1*m1*cos(q1L + qT) + ellycm2*m2*...
         cos(q2L + qT) + ellycm3*m3*cos(q2L + qT) + ellycm4*m4*...
         cos(q1L + qT) - ellzcm1*m1*sin(q1 + qT) - ellzcm2*m2*...
         sin(q2 + qT) - ellzcm3*m3*sin(q2 + qT) - ellzcm4*m4*...
         sin(q1 + qT) - ellzcm1*m1*sin(q1L + qT) - ellzcm2*m2*...
         sin(q2L + qT) - ellzcm3*m3*sin(q2L + qT) - ellzcm4*m4*...
         sin(q1L + qT);
De(3,3)=2*Jcm1 + 2*Jcm2 + 2*Jcm3 + 2*Jcm4 + JcmH + JcmT + 2*...
         Jgear1 + 2*Jgear2 + 2*Jrotor1 + 2*Jrotor2 + 2*L2^2*m1 + 2*L1^2*...
         m3 + 2*L2^2*m2 + 2*L2^2*m3 + 2*L4^2*m1 + 2*L2^2*m4 + 2*L4^2*...
         m2 + 2*L4^2*m3 + 2*L4^2*m4 + L2^2*mH + L4^2*mH + L2^2*mT + L4^2*...
         mT + 2*ellycm1^2*m1 + 2*ellzcm1^2*m1 + 2*ellycm2^2*m2 + 2*...
         ellzcm2^2*m2 + 2*ellycm3^2*m3 + 2*ellzcm3^2*m3 + 2*ellycm4^2*...
         m4 + 2*ellzcm4^2*m4 + ellycmT^2*mT + ellzcmT^2*mT - 2*L1*L4*...
         m3 - 2*L2^2*m4*cos(q2 - q2L) - 2*L2*ellzcm2*m2 - 2*L4*ellzcm1*...
         m1 - 2*L2*ellzcm3*m3 - 2*L4*ellzcm4*m4 - 2*L2*ellzcmT*mT*...
         cos(q2) - 2*L4*ellzcmT*mT*cos(q1) + 2*L2*ellycmT*mT*sin(q2) + 2*...
         L4*ellycmT*mT*sin(q1) - 2*L1*L2*m3*cos(q1 - q2) + 4*L2*L4*m1*...
         cos(q1 - q2) + 4*L2*L4*m2*cos(q1 - q2) + 4*L2*L4*m3*...
         cos(q1 - q2) + 2*L2*L4*m4*cos(q1 - q2) - 2*L1*L2*m3*...
         cos(q2 - q1L) - 2*L1*L4*m3*cos(q1 - q1L) - 2*L2*L4*m4*...
         cos(q1 - q2L) + 2*L2*L4*mH*cos(q1 - q2) + 2*L2*L4*mT*...
         cos(q1 - q2) - 2*L2*ellzcm1*m1*cos(q1 - q2) + 2*L1*ellzcm3*m3*...
         cos(q1 - q2) - 2*L4*ellzcm2*m2*cos(q1 - q2) - 2*L4*ellzcm3*m3*...
         cos(q1 - q2) - 2*L2*ellzcm1*m1*cos(q2 - q1L) - 2*L4*ellzcm1*m1*...
         cos(q1 - q1L) - 2*L2*ellzcm2*m2*cos(q2 - q2L) - 2*L4*ellzcm2*m2*...
         cos(q1 - q2L) - 2*L2*ellzcm3*m3*cos(q2 - q2L) - 2*L2*ellzcm4*m4*...
         cos(q2 - q1L) - 2*L4*ellzcm3*m3*cos(q1 - q2L) - 2*L4*ellzcm4*m4*...
         cos(q1 - q1L) + 2*L1*ellzcm3*m3*cos(q1L - q2L) + 2*L2*ellzcm4*m4*...
         cos(q1L - q2L) - 2*L2*ellycm1*m1*sin(q1 - q2) - 2*L1*ellycm3*m3*...
         sin(q1 - q2) + 2*L4*ellycm2*m2*sin(q1 - q2) + 2*L4*ellycm3*m3*...
         sin(q1 - q2) + 2*L2*ellycm1*m1*sin(q2 - q1L) + 2*L4*ellycm1*m1*...
         sin(q1 - q1L) + 2*L2*ellycm2*m2*sin(q2 - q2L) + 2*L4*ellycm2*m2*...
         sin(q1 - q2L) + 2*L2*ellycm3*m3*sin(q2 - q2L) + 2*L2*ellycm4*m4*...
         sin(q2 - q1L) + 2*L4*ellycm3*m3*sin(q1 - q2L) + 2*L4*ellycm4*m4*...
         sin(q1 - q1L) - 2*L1*ellycm3*m3*sin(q1L - q2L) + 2*L2*ellycm4*m4*...
         sin(q1L - q2L);
De(3,4)=Jcm1 + Jcm4 + Jgear1 + L1^2*m3 + 2*L4^2*m1 + 2*L4^2*...
         m2 + 2*L4^2*m3 + 2*L4^2*m4 + L4^2*mH + L4^2*mT + ellycm1^2*...
         m1 + ellzcm1^2*m1 + ellycm4^2*m4 + ellzcm4^2*m4 + Jrotor1*R1 - 2*...
         L1*L4*m3 - 2*L4*ellzcm1*m1 - 2*L4*ellzcm4*m4 - L4*ellzcmT*mT*...
         cos(q1) + L4*ellycmT*mT*sin(q1) - L1*L2*m3*cos(q1 - q2) + 2*L2*...
         L4*m1*cos(q1 - q2) + 2*L2*L4*m2*cos(q1 - q2) + 2*L2*L4*m3*...
         cos(q1 - q2) + L2*L4*m4*cos(q1 - q2) - L1*L4*m3*...
         cos(q1 - q1L) - L2*L4*m4*cos(q1 - q2L) + L2*L4*mH*...
         cos(q1 - q2) + L2*L4*mT*cos(q1 - q2) - L2*ellzcm1*m1*...
         cos(q1 - q2) + L1*ellzcm3*m3*cos(q1 - q2) - L4*ellzcm2*m2*...
         cos(q1 - q2) - L4*ellzcm3*m3*cos(q1 - q2) - L4*ellzcm1*m1*...
         cos(q1 - q1L) - L4*ellzcm2*m2*cos(q1 - q2L) - L4*ellzcm3*m3*...
         cos(q1 - q2L) - L4*ellzcm4*m4*cos(q1 - q1L) - L2*ellycm1*m1*...
         sin(q1 - q2) - L1*ellycm3*m3*sin(q1 - q2) + L4*ellycm2*m2*...
         sin(q1 - q2) + L4*ellycm3*m3*sin(q1 - q2) + L4*ellycm1*m1*...
         sin(q1 - q1L) + L4*ellycm2*m2*sin(q1 - q2L) + L4*ellycm3*m3*...
         sin(q1 - q2L) + L4*ellycm4*m4*sin(q1 - q1L);
De(3,5)=Jcm2 + Jcm3 + Jgear2 + 2*L2^2*m1 + 2*L2^2*m2 + 2*L2^2*...
         m3 + L2^2*m4 + L2^2*mH + L2^2*mT + ellycm2^2*m2 + ellzcm2^2*...
         m2 + ellycm3^2*m3 + ellzcm3^2*m3 + Jrotor2*R2 - L2^2*m4*...
         cos(q2 - q2L) - 2*L2*ellzcm2*m2 - 2*L2*ellzcm3*m3 - L2*ellzcmT*...
         mT*cos(q2) + L2*ellycmT*mT*sin(q2) - L1*L2*m3*cos(q1 - q2) + 2*...
         L2*L4*m1*cos(q1 - q2) + 2*L2*L4*m2*cos(q1 - q2) + 2*L2*L4*m3*...
         cos(q1 - q2) + L2*L4*m4*cos(q1 - q2) - L1*L2*m3*...
         cos(q2 - q1L) + L2*L4*mH*cos(q1 - q2) + L2*L4*mT*...
         cos(q1 - q2) - L2*ellzcm1*m1*cos(q1 - q2) + L1*ellzcm3*m3*...
         cos(q1 - q2) - L4*ellzcm2*m2*cos(q1 - q2) - L4*ellzcm3*m3*...
         cos(q1 - q2) - L2*ellzcm1*m1*cos(q2 - q1L) - L2*ellzcm2*m2*...
         cos(q2 - q2L) - L2*ellzcm3*m3*cos(q2 - q2L) - L2*ellzcm4*m4*...
         cos(q2 - q1L) - L2*ellycm1*m1*sin(q1 - q2) - L1*ellycm3*m3*...
         sin(q1 - q2) + L4*ellycm2*m2*sin(q1 - q2) + L4*ellycm3*m3*...
         sin(q1 - q2) + L2*ellycm1*m1*sin(q2 - q1L) + L2*ellycm2*m2*...
         sin(q2 - q2L) + L2*ellycm3*m3*sin(q2 - q2L) + L2*ellycm4*m4*...
         sin(q2 - q1L);
De(3,6)=Jcm1 + Jcm4 + Jgear1 + L1^2*m3 + ellycm1^2*...
         m1 + ellzcm1^2*m1 + ellycm4^2*m4 + ellzcm4^2*m4 + Jrotor1*...
         R1 - L1*L2*m3*cos(q2 - q1L) - L1*L4*m3*cos(q1 - q1L) - L2*...
         ellzcm1*m1*cos(q2 - q1L) - L4*ellzcm1*m1*cos(q1 - q1L) - L2*...
         ellzcm4*m4*cos(q2 - q1L) - L4*ellzcm4*m4*cos(q1 - q1L) + L1*...
         ellzcm3*m3*cos(q1L - q2L) + L2*ellzcm4*m4*cos(q1L - q2L) + L2*...
         ellycm1*m1*sin(q2 - q1L) + L4*ellycm1*m1*sin(q1 - q1L) + L2*...
         ellycm4*m4*sin(q2 - q1L) + L4*ellycm4*m4*sin(q1 - q1L) - L1*...
         ellycm3*m3*sin(q1L - q2L) + L2*ellycm4*m4*sin(q1L - q2L);
De(3,7)=Jcm2 + Jcm3 + Jgear2 + L2^2*m4 + ellycm2^2*...
         m2 + ellzcm2^2*m2 + ellycm3^2*m3 + ellzcm3^2*m3 + Jrotor2*...
         R2 - L2^2*m4*cos(q2 - q2L) - L2*L4*m4*cos(q1 - q2L) - L2*ellzcm2*...
         m2*cos(q2 - q2L) - L4*ellzcm2*m2*cos(q1 - q2L) - L2*ellzcm3*m3*...
         cos(q2 - q2L) - L4*ellzcm3*m3*cos(q1 - q2L) + L1*ellzcm3*m3*...
         cos(q1L - q2L) + L2*ellzcm4*m4*cos(q1L - q2L) + L2*ellycm2*m2*...
         sin(q2 - q2L) + L4*ellycm2*m2*sin(q1 - q2L) + L2*ellycm3*m3*...
         sin(q2 - q2L) + L4*ellycm3*m3*sin(q1 - q2L) - L1*ellycm3*m3*...
         sin(q1L - q2L) + L2*ellycm4*m4*sin(q1L - q2L);
De(4,1)=2*L4*m1*cos(q1 + qT) - L1*m3*cos(q1 + qT) + 2*L4*m2*...
         cos(q1 + qT) + 2*L4*m3*cos(q1 + qT) + 2*L4*m4*cos(q1 + qT) + L4*...
         mH*cos(q1 + qT) + L4*mT*cos(q1 + qT) - ellzcm1*m1*...
         cos(q1 + qT) - ellzcm4*m4*cos(q1 + qT) - ellycm1*m1*...
         sin(q1 + qT) - ellycm4*m4*sin(q1 + qT);
De(4,2)=2*L4*m1*sin(q1 + qT) - L1*m3*sin(q1 + qT) + 2*L4*m2*...
         sin(q1 + qT) + 2*L4*m3*sin(q1 + qT) + 2*L4*m4*sin(q1 + qT) + L4*...
         mH*sin(q1 + qT) + L4*mT*sin(q1 + qT) + ellycm1*m1*...
         cos(q1 + qT) + ellycm4*m4*cos(q1 + qT) - ellzcm1*m1*...
         sin(q1 + qT) - ellzcm4*m4*sin(q1 + qT);
De(4,3)=Jcm1 + Jcm4 + Jgear1 + L1^2*m3 + 2*L4^2*m1 + 2*L4^2*...
         m2 + 2*L4^2*m3 + 2*L4^2*m4 + L4^2*mH + L4^2*mT + ellycm1^2*...
         m1 + ellzcm1^2*m1 + ellycm4^2*m4 + ellzcm4^2*m4 + Jrotor1*R1 - 2*...
         L1*L4*m3 - 2*L4*ellzcm1*m1 - 2*L4*ellzcm4*m4 - L4*ellzcmT*mT*...
         cos(q1) + L4*ellycmT*mT*sin(q1) - L1*L2*m3*cos(q1 - q2) + 2*L2*...
         L4*m1*cos(q1 - q2) + 2*L2*L4*m2*cos(q1 - q2) + 2*L2*L4*m3*...
         cos(q1 - q2) + L2*L4*m4*cos(q1 - q2) - L1*L4*m3*...
         cos(q1 - q1L) - L2*L4*m4*cos(q1 - q2L) + L2*L4*mH*...
         cos(q1 - q2) + L2*L4*mT*cos(q1 - q2) - L2*ellzcm1*m1*...
         cos(q1 - q2) + L1*ellzcm3*m3*cos(q1 - q2) - L4*ellzcm2*m2*...
         cos(q1 - q2) - L4*ellzcm3*m3*cos(q1 - q2) - L4*ellzcm1*m1*...
         cos(q1 - q1L) - L4*ellzcm2*m2*cos(q1 - q2L) - L4*ellzcm3*m3*...
         cos(q1 - q2L) - L4*ellzcm4*m4*cos(q1 - q1L) - L2*ellycm1*m1*...
         sin(q1 - q2) - L1*ellycm3*m3*sin(q1 - q2) + L4*ellycm2*m2*...
         sin(q1 - q2) + L4*ellycm3*m3*sin(q1 - q2) + L4*ellycm1*m1*...
         sin(q1 - q1L) + L4*ellycm2*m2*sin(q1 - q2L) + L4*ellycm3*m3*...
         sin(q1 - q2L) + L4*ellycm4*m4*sin(q1 - q1L);
De(4,4)=Jcm1 + Jcm4 + Jgear1 + Jrotor1*R1^2 + L1^2*m3 + 2*L4^2*...
         m1 + 2*L4^2*m2 + 2*L4^2*m3 + 2*L4^2*m4 + L4^2*mH + L4^2*...
         mT + ellycm1^2*m1 + ellzcm1^2*m1 + ellycm4^2*m4 + ellzcm4^2*...
         m4 - 2*L1*L4*m3 - 2*L4*ellzcm1*m1 - 2*L4*ellzcm4*m4;
De(4,5)=2*L2*L4*m1*cos(q1 - q2) - L1*L2*m3*cos(q1 - q2) + 2*L2*...
         L4*m2*cos(q1 - q2) + 2*L2*L4*m3*cos(q1 - q2) + L2*L4*m4*...
         cos(q1 - q2) + L2*L4*mH*cos(q1 - q2) + L2*L4*mT*...
         cos(q1 - q2) - L2*ellzcm1*m1*cos(q1 - q2) + L1*ellzcm3*m3*...
         cos(q1 - q2) - L4*ellzcm2*m2*cos(q1 - q2) - L4*ellzcm3*m3*...
         cos(q1 - q2) - L2*ellycm1*m1*sin(q1 - q2) - L1*ellycm3*m3*...
         sin(q1 - q2) + L4*ellycm2*m2*sin(q1 - q2) + L4*ellycm3*m3*...
         sin(q1 - q2);
De(4,6)=-L4*(L1*m3*cos(q1 - q1L) + ellzcm1*m1*...
         cos(q1 - q1L) + ellzcm4*m4*cos(q1 - q1L) - ellycm1*m1*...
         sin(q1 - q1L) - ellycm4*m4*sin(q1 - q1L));
De(4,7)=-L4*(L2*m4*cos(q1 - q2L) + ellzcm2*m2*...
         cos(q1 - q2L) + ellzcm3*m3*cos(q1 - q2L) - ellycm2*m2*...
         sin(q1 - q2L) - ellycm3*m3*sin(q1 - q2L));
De(5,1)=2*L2*m1*cos(q2 + qT) + 2*L2*m2*cos(q2 + qT) + 2*L2*m3*...
         cos(q2 + qT) + L2*m4*cos(q2 + qT) + L2*mH*cos(q2 + qT) + L2*mT*...
         cos(q2 + qT) - ellzcm2*m2*cos(q2 + qT) - ellzcm3*m3*...
         cos(q2 + qT) - ellycm2*m2*sin(q2 + qT) - ellycm3*m3*sin(q2 + qT);
De(5,2)=2*L2*m1*sin(q2 + qT) + 2*L2*m2*sin(q2 + qT) + 2*L2*m3*...
         sin(q2 + qT) + L2*m4*sin(q2 + qT) + L2*mH*sin(q2 + qT) + L2*mT*...
         sin(q2 + qT) + ellycm2*m2*cos(q2 + qT) + ellycm3*m3*...
         cos(q2 + qT) - ellzcm2*m2*sin(q2 + qT) - ellzcm3*m3*sin(q2 + qT);
De(5,3)=Jcm2 + Jcm3 + Jgear2 + 2*L2^2*m1 + 2*L2^2*m2 + 2*L2^2*...
         m3 + L2^2*m4 + L2^2*mH + L2^2*mT + ellycm2^2*m2 + ellzcm2^2*...
         m2 + ellycm3^2*m3 + ellzcm3^2*m3 + Jrotor2*R2 - L2^2*m4*...
         cos(q2 - q2L) - 2*L2*ellzcm2*m2 - 2*L2*ellzcm3*m3 - L2*ellzcmT*...
         mT*cos(q2) + L2*ellycmT*mT*sin(q2) - L1*L2*m3*cos(q1 - q2) + 2*...
         L2*L4*m1*cos(q1 - q2) + 2*L2*L4*m2*cos(q1 - q2) + 2*L2*L4*m3*...
         cos(q1 - q2) + L2*L4*m4*cos(q1 - q2) - L1*L2*m3*...
         cos(q2 - q1L) + L2*L4*mH*cos(q1 - q2) + L2*L4*mT*...
         cos(q1 - q2) - L2*ellzcm1*m1*cos(q1 - q2) + L1*ellzcm3*m3*...
         cos(q1 - q2) - L4*ellzcm2*m2*cos(q1 - q2) - L4*ellzcm3*m3*...
         cos(q1 - q2) - L2*ellzcm1*m1*cos(q2 - q1L) - L2*ellzcm2*m2*...
         cos(q2 - q2L) - L2*ellzcm3*m3*cos(q2 - q2L) - L2*ellzcm4*m4*...
         cos(q2 - q1L) - L2*ellycm1*m1*sin(q1 - q2) - L1*ellycm3*m3*...
         sin(q1 - q2) + L4*ellycm2*m2*sin(q1 - q2) + L4*ellycm3*m3*...
         sin(q1 - q2) + L2*ellycm1*m1*sin(q2 - q1L) + L2*ellycm2*m2*...
         sin(q2 - q2L) + L2*ellycm3*m3*sin(q2 - q2L) + L2*ellycm4*m4*...
         sin(q2 - q1L);
De(5,4)=2*L2*L4*m1*cos(q1 - q2) - L1*L2*m3*cos(q1 - q2) + 2*L2*...
         L4*m2*cos(q1 - q2) + 2*L2*L4*m3*cos(q1 - q2) + L2*L4*m4*...
         cos(q1 - q2) + L2*L4*mH*cos(q1 - q2) + L2*L4*mT*...
         cos(q1 - q2) - L2*ellzcm1*m1*cos(q1 - q2) + L1*ellzcm3*m3*...
         cos(q1 - q2) - L4*ellzcm2*m2*cos(q1 - q2) - L4*ellzcm3*m3*...
         cos(q1 - q2) - L2*ellycm1*m1*sin(q1 - q2) - L1*ellycm3*m3*...
         sin(q1 - q2) + L4*ellycm2*m2*sin(q1 - q2) + L4*ellycm3*m3*...
         sin(q1 - q2);
De(5,5)=Jcm2 + Jcm3 + Jgear2 + Jrotor2*R2^2 + 2*L2^2*m1 + 2*L2^2*...
         m2 + 2*L2^2*m3 + L2^2*m4 + L2^2*mH + L2^2*mT + ellycm2^2*...
         m2 + ellzcm2^2*m2 + ellycm3^2*m3 + ellzcm3^2*m3 - 2*L2*ellzcm2*...
         m2 - 2*L2*ellzcm3*m3;
De(5,6)=-L2*(L1*m3*cos(q2 - q1L) + ellzcm1*m1*...
         cos(q2 - q1L) + ellzcm4*m4*cos(q2 - q1L) - ellycm1*m1*...
         sin(q2 - q1L) - ellycm4*m4*sin(q2 - q1L));
De(5,7)=-L2*(L2*m4*cos(q2 - q2L) + ellzcm2*m2*...
         cos(q2 - q2L) + ellzcm3*m3*cos(q2 - q2L) - ellycm2*m2*...
         sin(q2 - q2L) - ellycm3*m3*sin(q2 - q2L));
De(6,1)=- L1*m3*cos(q1L + qT) - ellzcm1*m1*...
         cos(q1L + qT) - ellzcm4*m4*cos(q1L + qT) - ellycm1*m1*...
         sin(q1L + qT) - ellycm4*m4*sin(q1L + qT);
De(6,2)=ellycm1*m1*cos(q1L + qT) - L1*m3*sin(q1L + qT) + ellycm4*...
         m4*cos(q1L + qT) - ellzcm1*m1*sin(q1L + qT) - ellzcm4*m4*...
         sin(q1L + qT);
De(6,3)=Jcm1 + Jcm4 + Jgear1 + L1^2*m3 + ellycm1^2*...
         m1 + ellzcm1^2*m1 + ellycm4^2*m4 + ellzcm4^2*m4 + Jrotor1*...
         R1 - L1*L2*m3*cos(q2 - q1L) - L1*L4*m3*cos(q1 - q1L) - L2*...
         ellzcm1*m1*cos(q2 - q1L) - L4*ellzcm1*m1*cos(q1 - q1L) - L2*...
         ellzcm4*m4*cos(q2 - q1L) - L4*ellzcm4*m4*cos(q1 - q1L) + L1*...
         ellzcm3*m3*cos(q1L - q2L) + L2*ellzcm4*m4*cos(q1L - q2L) + L2*...
         ellycm1*m1*sin(q2 - q1L) + L4*ellycm1*m1*sin(q1 - q1L) + L2*...
         ellycm4*m4*sin(q2 - q1L) + L4*ellycm4*m4*sin(q1 - q1L) - L1*...
         ellycm3*m3*sin(q1L - q2L) + L2*ellycm4*m4*sin(q1L - q2L);
De(6,4)=-L4*(L1*m3*cos(q1 - q1L) + ellzcm1*m1*...
         cos(q1 - q1L) + ellzcm4*m4*cos(q1 - q1L) - ellycm1*m1*...
         sin(q1 - q1L) - ellycm4*m4*sin(q1 - q1L));
De(6,5)=-L2*(L1*m3*cos(q2 - q1L) + ellzcm1*m1*...
         cos(q2 - q1L) + ellzcm4*m4*cos(q2 - q1L) - ellycm1*m1*...
         sin(q2 - q1L) - ellycm4*m4*sin(q2 - q1L));
De(6,6)=Jcm1 + Jcm4 + Jgear1 + Jrotor1*R1^2 + L1^2*...
         m3 + ellycm1^2*m1 + ellzcm1^2*m1 + ellycm4^2*m4 + ellzcm4^2*m4;
De(6,7)=L1*ellzcm3*m3*cos(q1L - q2L) + L2*ellzcm4*m4*...
         cos(q1L - q2L) - L1*ellycm3*m3*sin(q1L - q2L) + L2*ellycm4*m4*...
         sin(q1L - q2L);
De(7,1)=- L2*m4*cos(q2L + qT) - ellzcm2*m2*...
         cos(q2L + qT) - ellzcm3*m3*cos(q2L + qT) - ellycm2*m2*...
         sin(q2L + qT) - ellycm3*m3*sin(q2L + qT);
De(7,2)=ellycm2*m2*cos(q2L + qT) - L2*m4*sin(q2L + qT) + ellycm3*...
         m3*cos(q2L + qT) - ellzcm2*m2*sin(q2L + qT) - ellzcm3*m3*...
         sin(q2L + qT);
De(7,3)=Jcm2 + Jcm3 + Jgear2 + L2^2*m4 + ellycm2^2*...
         m2 + ellzcm2^2*m2 + ellycm3^2*m3 + ellzcm3^2*m3 + Jrotor2*...
         R2 - L2^2*m4*cos(q2 - q2L) - L2*L4*m4*cos(q1 - q2L) - L2*ellzcm2*...
         m2*cos(q2 - q2L) - L4*ellzcm2*m2*cos(q1 - q2L) - L2*ellzcm3*m3*...
         cos(q2 - q2L) - L4*ellzcm3*m3*cos(q1 - q2L) + L1*ellzcm3*m3*...
         cos(q1L - q2L) + L2*ellzcm4*m4*cos(q1L - q2L) + L2*ellycm2*m2*...
         sin(q2 - q2L) + L4*ellycm2*m2*sin(q1 - q2L) + L2*ellycm3*m3*...
         sin(q2 - q2L) + L4*ellycm3*m3*sin(q1 - q2L) - L1*ellycm3*m3*...
         sin(q1L - q2L) + L2*ellycm4*m4*sin(q1L - q2L);
De(7,4)=-L4*(L2*m4*cos(q1 - q2L) + ellzcm2*m2*...
         cos(q1 - q2L) + ellzcm3*m3*cos(q1 - q2L) - ellycm2*m2*...
         sin(q1 - q2L) - ellycm3*m3*sin(q1 - q2L));
De(7,5)=-L2*(L2*m4*cos(q2 - q2L) + ellzcm2*m2*...
         cos(q2 - q2L) + ellzcm3*m3*cos(q2 - q2L) - ellycm2*m2*...
         sin(q2 - q2L) - ellycm3*m3*sin(q2 - q2L));
De(7,6)=L1*ellzcm3*m3*cos(q1L - q2L) + L2*ellzcm4*m4*...
         cos(q1L - q2L) - L1*ellycm3*m3*sin(q1L - q2L) + L2*ellycm4*m4*...
         sin(q1L - q2L);
De(7,7)=Jcm2 + Jcm3 + Jgear2 + Jrotor2*R2^2 + L2^2*...
         m4 + ellycm2^2*m2 + ellzcm2^2*m2 + ellycm3^2*m3 + ellzcm3^2*m3;
%%%%
%%%%
%%%%
%%%%
E=zeros(2,7);
E(1,1)=1;
E(1,3)=L2*cos(q2 + qT) + L4*cos(q1 + qT) - L2*cos(q2L + qT) - L4*...
         cos(q1L + qT);
E(1,4)=L4*cos(q1 + qT);
E(1,5)=L2*cos(q2 + qT);
E(1,6)=-L4*cos(q1L + qT);
E(1,7)=-L2*cos(q2L + qT);
E(2,2)=1;
E(2,3)=L2*sin(q2 + qT) + L4*sin(q1 + qT) - L2*sin(q2L + qT) - L4*...
         sin(q1L + qT);
E(2,4)=L4*sin(q1 + qT);
E(2,5)=L2*sin(q2 + qT);
E(2,6)=-L4*sin(q1L + qT);
E(2,7)=-L2*sin(q2L + qT);
return