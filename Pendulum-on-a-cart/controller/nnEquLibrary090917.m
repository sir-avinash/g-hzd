function [y1] = nnEquLibrary090917(x1)
%NNEQULIBRARY090917 neural network simulation function.
%
% Generated by Neural Network Toolbox function genFunction, 09-Sep-2017 19:01:31.
% 
% [y1] = nnEquLibrary090917(x1) takes these arguments:
%   x = 4xQ matrix, input #1
% and returns:
%   y = 3xQ matrix, output #1
% where Q is the number of samples.

%#ok<*RPMT0>

% ===== NEURAL NETWORK CONSTANTS =====

% Input 1
x1_step1.keep = [1 2 3];
x1_step2.xoffset = [-1.7535490606418;-1.82739586340795;0];
x1_step2.gain = [0.551541109233804;0.65010074564326;1];
x1_step2.ymin = -1;

% Layer 1
b1 = [5.1155191538665434;-9.2651986508448498;2.8331158919633816;20.455695990040127;-3.1486583706785516;-12.729035868700439;-16.358202318346372;8.7987549531711391;1.1451775637885722;-2.498710936560149;-2.7554846994513755;-5.5916198498921155;-0.91942407850642083;5.3885397447123466;6.3587865638731982;0.56478846306452646;-0.70628740259575307;-6.530021166041946;-3.7976857334375942;-7.1074883933276629;2.306537553443774;-1.0996072713200464;1.0546715877622557;0.083296190605128453;4.0058135812969944;-0.9296814633870446;0.28827313307173297;-0.77255952760677427;-0.61527172954140397;-1.6840580535640246;2.3055425806890844;-1.1942860919883749;0.46050538100251365;1.7863766472459943;-2.6381532361281388;1.7725699764728813;1.1248463431854865;3.2769880147803878;-2.8421932541207933;-3.4829747617211968;8.7364485527092182;-2.0978423055616036;6.7431462605067081;-5.4175565139831736;13.878590428677974;2.9010259815845054;-5.0792453661551642;4.4631418165317891;-26.05368355802203;12.760012656786003];
IW1_1 = [-0.24655169458354192 -0.12390478474382578 -4.4876298957565997;-0.031887126600116937 0.25387641691825585 -8.2485753258242624;-1.7097168519126829 -1.514514734957721 0.65472933283094636;0.0064939758011310746 0.41223070297389319 -20.582188388442361;0.045152435023755939 0.13266859635561926 -3.9595877263206818;0.038182515324822523 -0.3030514260234124 -12.741779096268552;0.031335866613588274 -0.34695551940037572 15.667269296656745;0.28691186117142697 2.0407956781884264 -7.0822481229256358;-0.0170896956578808 -0.3545896785050171 1.7541277753232736;0.95484114014441113 -0.83618950269501613 0.33858883875920925;1.9424367917896188 -1.22972789854659 0.1335577224458914;0.028337344681383055 -0.45103644200554266 -4.2433763680092271;0.22873501311372091 0.38266359420021029 -0.27642496354002094;0.02839833150967223 -0.32875722056441353 5.7016974471335358;-0.058001231943167544 0.6913509543242341 -5.9820079093093526;-0.12637932111785471 -1.1812589916317071 -0.66496026486242987;0.19243875828376017 1.3372255113457254 -0.59678728077253995;0.065016931289865965 0.33318476423132726 6.7283146716998639;-0.32859392920706099 -3.285211567370081 1.6293714678372142;-0.055095733393202957 -0.6557361374506584 6.9952670137559538;-5.5124120855736827 2.0709553614470879 0.92541353916101798;-0.47387745234069945 -2.2022324944980536 1.4335067317657697;-0.031265473825607501 -0.43084388882862856 -2.478358782058061;0.055133501575951802 0.92092916916558176 0.0057032180541986286;0.49094469661471818 4.2450305345068609 -2.2367908356549795;-0.0030408594477685158 0.41767266434876471 2.6716005253403443;-0.08674113757344358 -0.97463841479128599 0.33662597842617242;-0.036704527219618338 -0.12377089769255202 -2.7375533752336794;0.25099625804272774 0.34270156506296712 -1.6487750215865211;0.030847529954980035 0.10835547636732588 -1.8791248134343574;0.153546659244752 -0.51513759744905407 -3.0679258657347779;-0.26434399284659804 -0.54030666679149486 -0.24256073052844529;0.060776287544766459 0.071136067785400825 1.6209201126153372;-0.026279084131596925 -0.050790160640653337 3.0495330196428068;-1.8192274474857602 -0.62067760299345121 -0.91008606211669896;0.28868630035359144 0.30121285381700313 -1.8919717178593378;0.46363784965756288 2.2759797116172802 -1.4564862588335976;0.0079665722754704606 -0.76775741833878319 4.1154851169397855;-0.072006696266384243 0.018192171638874745 -2.5176649060822398;-2.2878822052892587 -0.27668938116507907 -1.8078193922042836;-0.026919400785749122 0.16423988852669244 7.5696662404019213;-1.0680813412456145 1.0465104637989684 0.79976223193944818;1.0590342003795878 4.8365733439350214 -4.0539010712871351;-2.0311657470530484 -5.3700111237466341 1.6240763262980931;0.038496654502107798 0.041921274284272905 14.08208057741717;0.39837241921889838 -0.90441732865626512 -0.61916387408506801;-1.8293729853299046 -4.8282298172857763 1.3762819363957983;1.3548725082409954 3.7631258336741311 -0.83766994052877386;0.098743671289582877 1.121978804467229 27.573424556795391;-0.022537853960128609 0.21724532532322754 12.765441389012262];

% Layer 2
b2 = [4.052080193436681;0.66574652415276303;-1.7131947648202082];
LW2_1 = [5.2567643469978336 -8.4056095512906666 -0.00091748240722529717 7.0668150416065885 -3.1254141047730868 -4.3844006672285731 14.908208973155144 3.419913785182926 0.85408365245842244 0.17794190130531018 -0.016347962898068679 2.9079302345254194 -0.5576116120859852 2.1607639658206752 -4.0480374653756863 0.035634098796244164 -0.032302718082984565 4.285851442822822 -0.2550276274601922 -4.9847573455265142 4.2744039688709312e-05 -0.58534353871088951 -2.789151929131322 -0.29612177118947686 0.026453815085323396 -2.2498429863813962 -0.32355183977686092 -0.90346965797079648 0.099796940964182526 11.345067629738718 0.82310359403452782 0.38595345383932195 -0.60067897434851769 2.5832742207762038 -0.017646147526907931 -0.56220465799054276 -0.53828139032589428 0.13980955295612096 3.0012389132726187 0.0098056667138146161 1.7057639326002867 -0.0028223624616239324 -0.53598147790315498 0.31794359306189801 2.2288099413195832 -0.4681642890259432 -0.59284888219637855 -0.38862567246242985 1.2827910525221551 -8.108263615091678;0.32626354173402422 -0.5316390026952762 0.0090289922650675491 -0.091439113891169183 1.1080436220567285 -0.23526163187438148 -0.12035843260875909 -0.7830920244177566 -0.38003487989136719 0.073068256181294325 -0.00053115410538848607 1.6451447324512487 -0.23047245697366259 -0.67346062370722237 0.95688919713288767 -0.13964904583422819 -0.44487645988205959 -1.4036700194624914 -1.0153059686798251 1.7634075763128094 -0.00043540542080223392 1.2483836251053833 -1.3909905644004146 -0.27599144228847383 -0.25277286881544586 -0.73633463250706765 -1.0735057978670826 0.97374534896067344 0.22998779485664358 -2.7840167690069526 0.36646657133739496 0.70516249163610922 2.9425993761597788 -1.4140930035397385 -0.030299825024029375 0.49101792916714904 1.2502064459465538 -0.091406835115327073 -1.2748374053789064 0.0098185329994972519 -0.99813348838367166 -0.0097421938653048934 0.47104092225469252 0.57392113835401304 -0.13797431751434552 -0.82950108090590136 -0.93084123138903352 -0.42116760788372554 -0.01785479797508225 -0.075979640623369107;1.9122983093888624 7.0214640865666595 0.0054554124086931381 0.34986515420678788 0.33154291765152683 1.5242208320967419 1.6296201612862036 5.0235317200229872 0.68096592739295059 -0.17695664971237748 0.027775266272337243 -1.1587572228901335 -0.40182082155371412 -0.8222516878960977 -0.93541088032785324 0.061370541288272393 -0.3856720381157539 -0.14833341243694734 1.4518374172251181 0.79719603055740151 -0.00026602961636280117 0.12164243202451541 0.058415875661562686 -1.0415768055036989 0.59312918464623421 -0.57686935413914642 -1.7034874600421912 -0.0046265801748123954 -0.012509124503593302 1.6508850835537523 0.99161307557353728 0.77381461321480149 0.89721773545678185 0.33018693227561952 -0.0014891073977731722 -0.90385551944116771 0.23406045578107551 0.02569150214016935 -3.8766672549463808 0.00024065106778017677 4.9473574386575629 -0.062405753403369277 -0.41574384901387984 0.17198377263928616 -0.40893713881789678 -2.069504669526379 -0.25855997380602824 -0.09094622565160361 0.097389539015215826 2.2339141149827495];

% Output 1
y1_step1.ymin = -1;
y1_step1.gain = [0.101941768800528;2.27919715368228;0.550944885785302];
y1_step1.xoffset = [-9.50135485858554;-0.479445544746851;-2.35191541538924];

% ===== SIMULATION ========

% Dimensions
Q = size(x1,2); % samples

% Input 1
xp1 = removeconstantrows_apply(x1,x1_step1);
xp1 = mapminmax_apply(xp1,x1_step2);

% Layer 1
a1 = tansig_apply(repmat(b1,1,Q) + IW1_1*xp1);

% Layer 2
a2 = repmat(b2,1,Q) + LW2_1*a1;

% Output 1
y1 = mapminmax_reverse(a2,y1_step1);
end

% ===== MODULE FUNCTIONS ========

% Map Minimum and Maximum Input Processing Function
function y = mapminmax_apply(x,settings)
  y = bsxfun(@minus,x,settings.xoffset);
  y = bsxfun(@times,y,settings.gain);
  y = bsxfun(@plus,y,settings.ymin);
end

% Remove Constants Input Processing Function
function y = removeconstantrows_apply(x,settings)
  y = x(settings.keep,:);
end

% Sigmoid Symmetric Transfer Function
function a = tansig_apply(n,~)
  a = 2 ./ (1 + exp(-2*n)) - 1;
end

% Map Minimum and Maximum Output Reverse-Processing Function
function x = mapminmax_reverse(y,settings)
  x = bsxfun(@minus,y,settings.ymin);
  x = bsxfun(@rdivide,x,settings.gain);
  x = bsxfun(@plus,x,settings.xoffset);
end
