function [y1] = nnEquLibrary(x1)
%NNORBITLIBRARY_X neural network simulation function.
%
% Generated by Neural Network Toolbox function genFunction, 25-Jul-2017 13:24:30.
% 
% [y1] = nnOrbitLibrary_x(x1) takes these arguments:
%   x = 4xQ matrix, input #1
% and returns:
%   y = 3xQ matrix, output #1
% where Q is the number of samples.

%#ok<*RPMT0>

% ===== NEURAL NETWORK CONSTANTS =====

% Input 1
x1_step1.keep = [1 2 3];
x1_step2.xoffset = [-1.27629512948527;-1.03870784644102;0];
x1_step2.gain = [0.783517837604926;0.96273461630848;1];
x1_step2.ymin = -1;

% Layer 1
b1 = [-0.35418762566728645;-3.0014326563637841;-0.25057735388182062;0.018083296992729852;3.1881424892517884;-2.5296815169336559;-0.15065059875510628;-2.1913909002096603;-14.730809242952974;4.8506307942627016;8.5075353643347249;-1.3763138165697024;0.0013687130531007444;-0.66676034872387158;8.4313982251117832;-17.819859572882113;-2.573651881761978;6.9472306643884805;0.64903885767458103;0.14500454952717487;1.0888269373829458;-15.149575979766205;2.8397205573564488;4.727312377390481;-3.9404470593206069;1.379911280771432;0.054064055090489282;-0.5897974532878435;0.4959377949055998;6.9653117426825553;3.2741125135657878;-4.7527331034083247;13.186583293036115;13.160427274796453;2.643393801768255;0.63185728359435667;-0.58306746905609297;0.78805453064426689;-0.023423487192642544;0.70961849136633248;-0.60355895097964685;-0.48965410137608978;-0.063875786159477019;-0.97627530130966522;17.899089566982266;-1.4793818921734809;0.35776071152573252;-1.7092753977844986;-1.5871540239962554;-1.4107278729581976];
IW1_1 = [-0.077406596165789751 -0.061489277477486594 1.9543463621983721;0.041214831123672212 -0.24574671627708128 3.9843289493465375;-0.032264096421563124 -0.83940821998559656 -0.2654543148224115;-0.29213627621560051 -0.17997639996847778 -0.15861876148145351;-0.020987891508753253 -1.3964389106986632 -2.8234420441258639;-0.089711125736378974 -0.078318158731646867 3.328594565454122;0.27919105521480253 0.080568299159968854 0.42064508272295892;0.19594439072364123 -0.10332806831449355 -1.324494393357089;0.037428965909132771 0.8459727038818734 13.911565936631263;0.2314615375255446 0.66111590446126622 -5.0099901164661844;-0.066880669118836084 0.094360885491173649 8.9233808582055918;0.28364041769641335 0.35497407801770353 0.51357964280930135;-0.012457992143824688 0.99827072082679147 0.48132873998889231;0.065560758979249498 -0.30120911417285501 -1.1647749943069603;0.065308007130004689 -0.10328982622038904 8.8284793711243719;0.047596552644132699 0.70837106236770864 17.854565360496068;0.08403558450355883 -0.17958396326065129 -2.664233135581433;0.065621980199101454 -0.11492606080892492 6.9587687342239573;0.28209438991362568 -0.026190274230860705 0.18920166546588629;-0.10592988842052661 0.023195514477230478 -0.77997449417262565;0.24711032605101502 0.1049902616326715 -0.36934103278333402;-0.038626829678920102 -0.82625083764092799 14.471642007931102;-0.18677537394234653 -0.58267864152926185 -2.9422930198696422;-0.099861502384879675 -0.83395041413873783 -4.1907045484994647;-0.10148870587410072 0.28016156149801508 -3.1137895828031139;0.13968894508674734 -0.38899495564838099 1.0641590153373104;-0.23336769948369548 -0.21660268131883567 -0.053006055585962691;0.062234173957951257 0.21001067676819982 -1.8321593668659453;-0.049968534532466212 -0.52101648556873636 0.11642383110574886;-0.067255689665506879 0.10278909813796876 6.9717399784310095;0.097154115466751276 0.23097161856275783 2.5755495497062464;-0.090542276312910827 -0.83593975519229091 4.2514700908775573;-0.031034172827380344 0.13637348449353476 12.453783562813058;0.03542543430528805 -0.15615081556746371 12.423772197517996;0.067554885821878144 -0.10470582428989592 2.7514125706510519;-0.19884704781715759 0.14760782325795635 0.28786321592921749;0.057114278995013104 0.39098246772512457 0.76289236395732141;0.0039369522104351785 0.96233666390881389 0.14082850720260956;-0.064194927553271081 0.40218757159385116 -0.34760184631742497;0.025149680597648449 -0.51195328026755471 -1.0534516459385475;-0.10056378367607227 -0.54654190948746939 0.91383879001189505;0.096618354708054133 0.18543734405502579 -0.7841550843742584;0.34194052310979528 0.28330135080719998 -0.077299716289269862;-0.10094111668558355 0.11771517310010952 -1.7272727467578985;0.04773134059071394 0.74313447219360929 -17.930280978506012;0.065791806332884228 -0.21680535722589664 -1.5972598316857616;-0.18358589036842021 -0.39416235101699043 0.63107417178344993;0.03307819437246122 0.23506834500695906 -2.0721063223972207;-0.018674530084658421 0.39906535851492481 2.571895223430412;-0.057760302277424784 0.24516677105040938 2.7141943139915896];

% Layer 2
b2 = [0.46533806515261378;0.46010533979699136;-0.71975979801113543];
LW2_1 = [0.064727644345571669 -0.51410126403352541 -0.32388729462996035 -0.73322180988106267 0.90742588493881515 1.5038534143163356 -0.60151545626740521 -2.4529635476537357 -9.3120863034995267 -0.26024756626462803 1.7032049154875226 0.16337100343554087 -0.46065638658566921 1.7316368237570643 -1.9787820775527758 4.9384770659943342 2.4618820842346527 6.007869929825187 -0.53681351956008472 -2.9240565984501496 -0.3492938170438859 8.1223737877865787 0.25777292747966513 -4.2022014438780673 4.5794007733278228 -1.2555430344110017 -0.16353859323329648 0.37155479753530202 0.084269859802616573 -5.1442757144434941 -0.4889184187442947 -3.6137281504824998 -1.7973358327660369 2.0118176178130569 3.7325778303010226 1.3628954813511636 0.73539548415372169 -0.62138803929281305 2.2055719439881116 2.3249359826694844 -0.32476425662473124 -2.5289071013162792 -0.38963048470672296 -1.0199647851044917 5.2431317614588711 0.53428329923915241 -0.63356212158118352 0.63412318863478767 -1.2607702025599312 0.79929886664722427;0.099004757132330437 1.7090143652011345 -0.25833889107847557 0.39160660027483501 0.026312816094321206 -3.1040097466500409 0.33482301831554301 -0.98475841499195615 0.6349510486900094 -0.72641619343063357 -0.87243813695914119 0.46183389863583219 0.026186266298462733 -0.12553781598744324 0.76703617142922753 0.48876293090900419 -0.29638575763345176 -1.0766747914628789 -0.30984607798619168 0.015079122864012109 0.41042424509817788 -0.17097566707063988 0.79851958177462534 1.7691447521846249 -0.88969309210972491 -0.16954460023844065 0.064145991924441842 0.78351708788597285 0.52884638540076057 1.3844014767891168 -3.10615293065531 1.3503060196426626 -2.9085306801816122 2.8848436372667026 0.88452170820212239 0.34223696060654846 0.50315730793625069 -0.16805681597387931 -0.38712908289808334 -0.9504123161187048 -1.4208447327568197 0.91562435103527273 0.22645021187683476 -1.6845042434239439 0.60849420641223628 -1.0262483709847132 -0.25497857369188537 2.0421063216174469 2.9567189512652154 -1.5377759791887207;1.2573215924260293 0.053256998562791709 0.36234000803992872 -0.2918875581208491 0.13109103510639372 1.4939265204359404 0.4569240696011575 -0.076903365817432415 -0.00039867842277132009 -1.4341995261843601 0.35752004283516425 1.5775064259291425 0.0042545693215111447 0.61861220252160831 -0.53761488562664395 0.79277701082024654 0.37637255758591431 0.46403902346540921 0.30061686696364348 3.5306506581152757 1.2160452502483934 -0.026882974324557177 1.8609646509849433 -1.4075064216638331 1.779026222205474 -0.86158573611456313 -1.2088553383538856 -1.2613472275894309 -1.0457077755223558 -0.030171179486993119 1.9117197429682975 -2.1641520549914137 3.2584429446851129 -3.3525097714230587 0.13938039957705808 0.053849948905978544 -1.9006488505198531 0.15308286844063082 1.026143484003109 0.63431145712519388 0.1397366749472165 -1.9696819080338497 -0.37011202678544247 0.29136946812853642 0.67824139908179526 1.1434929020190048 -0.61773059139003428 -1.5292471720361174 -1.1790882571529697 1.3044875498248416];

% Output 1
y1_step1.ymin = -1;
y1_step1.gain = [0.129127282712607;7.26074127155172;0.845880561664693];
y1_step1.xoffset = [-7.74429678215764;-0.137726984422113;-1.1822];

% ===== SIMULATION ========

% Dimensions
Q = size(x1,2); % samples

% Input 1
xp1 = removeconstantrows_apply(x1,x1_step1);
xp1 = mapminmax_apply(xp1,x1_step2);

% Layer 1
a1 = tansig_apply(repmat(b1,1,Q) + IW1_1*xp1);

% Layer 2
a2 = repmat(b2,1,Q) + LW2_1*a1;

% Output 1
y1 = mapminmax_reverse(a2,y1_step1);
end

% ===== MODULE FUNCTIONS ========

% Map Minimum and Maximum Input Processing Function
function y = mapminmax_apply(x,settings)
  y = bsxfun(@minus,x,settings.xoffset);
  y = bsxfun(@times,y,settings.gain);
  y = bsxfun(@plus,y,settings.ymin);
end

% Remove Constants Input Processing Function
function y = removeconstantrows_apply(x,settings)
  y = x(settings.keep,:);
end

% Sigmoid Symmetric Transfer Function
function a = tansig_apply(n,~)
  a = 2 ./ (1 + exp(-2*n)) - 1;
end

% Map Minimum and Maximum Output Reverse-Processing Function
function x = mapminmax_reverse(y,settings)
  x = bsxfun(@minus,y,settings.ymin);
  x = bsxfun(@rdivide,x,settings.gain);
  x = bsxfun(@plus,x,settings.xoffset);
end
