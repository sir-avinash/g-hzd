function [y1] = nnEquBack080917(x1)
%NNEQUBACK080917 neural network simulation function.
%
% Generated by Neural Network Toolbox function genFunction, 08-Sep-2017 14:07:10.
% 
% [y1] = nnEquBack080917(x1) takes these arguments:
%   x = 4xQ matrix, input #1
% and returns:
%   y = 3xQ matrix, output #1
% where Q is the number of samples.

%#ok<*RPMT0>

% ===== NEURAL NETWORK CONSTANTS =====

% Input 1
x1_step1.keep = [1 2 3];
x1_step2.xoffset = [-1.71418047078468;-2;0];
x1_step2.gain = [0.5833691475567;0.5;1];
x1_step2.ymin = -1;

% Layer 1
b1 = [17.173174758516193;8.6923494602534603;15.930535719681846;-25.073918246222814;-7.4343169094938464;13.163353576003438;-17.460807430710481;-11.717621438910056;-1.3178361862540995;-16.467834980469384;-11.660681833303215;-4.1752098354204161;2.8640575286838197;-3.9386111822182364;4.3427259056578373;-1.2428838172302654;-2.1930181390908059;5.1646314994719029;-1.9815895840218087;-1.1329216773363249;0.30006972734529436;0.020008871652935734;-1.1460688063410644;-0.2191068175937653;0.23998231914067827;-1.0380414747126829;0.12377158849680231;-0.077731972590364962;-0.14790742889583058;0.5893091781130948;-0.72052378456871014;1.5371072844717746;-17.165522220532221;-1.7530302801468418;-3.9724068173951967;-11.719072762274289;2.0437598438466416;-9.6205177213258377;9.804990328665987;3.8911740508866273;-0.59219432765939739;19.380280374236651;3.3262607556588573;-13.69746377342539;2.2538187810648282;-2.132577840057214;20.308307933809786;2.11653979959801;8.681102903700074;-3.6247201479225288];
IW1_1 = [-0.20630315440296962 -0.19896458989624694 -16.158306679472577;-4.9189263921349324 -2.1093284549415174 3.970421924732328;-0.53568713786942646 -0.30846413761519542 15.254079612370045;-0.26499726666709617 -0.20706982631284834 23.839304127596055;1.0921062995006894 0.90718146964189006 -6.6556190105495299;0.25217822922208094 0.13462598778511994 12.443468484520247;-0.11082894858007833 15.011179413621353 -0.32771648004791387;-0.060389646366172722 -0.074920812917861401 -12.276907254765415;0.90977530738638601 0.61563690902061774 -1.3325221180980462;1.5283112246523087 0.64065827800553765 16.02295330952759;10.185607869837904 10.050714653704972 4.8537305595529112;-0.18562770748715504 -0.16358375545840323 -4.330689870947193;-0.94092440745691863 -1.9329723894918402 -0.75184992941865547;-0.3402744476069165 -0.26198097888253907 -3.7330071422859405;0.080383303381727556 0.10113846866575138 4.8092566474761496;0.7176675016644094 0.48032748534612607 -1.3221944117220439;1.3026949975248612 0.41347187393395507 1.358451086287233;-0.94502473987864 -0.52123180505672917 -3.8971980968562154;0.50539952495512286 0.72342430379236955 2.4109801187247801;0.33288548613360502 0.18007353199919268 -1.2146357893360746;-0.22647804436935787 -0.1656151825432769 1.0312772072127656;-0.33946268765671933 -0.086295882963090306 -0.99573017518174411;0.93206706394276828 0.34989194327211492 0.56258689741579748;0.16426147730420171 0.32191896336298159 0.12419995401294012;0.34297505891590119 0.60236435622713469 -0.99810050115994731;0.65141472414734702 0.049569951068726546 -0.23074560807794689;0.63955487565152369 0.2051740581412583 1.0863159151914568;-0.45266449147965893 -0.14272565780840116 -0.84659317203612039;-0.45828382027749814 -0.1127342843235758 0.27362367642621072;0.29000483640344182 0.26019741996360196 -1.2570955393321426;2.2204569785542869 -0.67378934977991223 -0.052977772320067368;0.67085648543530241 0.54321042703605105 0.061208948078637554;-0.12689684942616331 0.1690469642357619 16.823726163454015;-0.62598406279137242 -0.25567415367146806 -1.5073733901996722;-0.55493011457287988 -0.47103249707122763 2.8678071562302319;-2.4473305779008623 -7.9301274470349599 -0.45669110971005139;0.67189151999888219 0.43991134804744064 -2.5781860784223407;-1.9573294149308953 -8.1674179342329651 0.75970251869095162;-0.14808110070049765 -0.032332259686160519 10.054734831830949;1.3791701044969742 0.61454178233098466 -3.8177552850051271;-0.73314034103626102 0.10806498993763676 -0.014578977718240287;0.21853224051412154 0.13502371526699986 19.186984234427989;0.41477332754407326 0.36265108510622041 2.5519696529876237;0.36172527549852157 15.718676037903924 4.1083252989374683;1.6572359555404947 -0.22023760565879122 -0.50255633707827529;-1.0767374269141667 -0.32450655840126003 0.053010713678882153;0.76061960881104185 0.073061102400013303 -19.999683949538728;1.382323631139516 -0.55822580326782156 -0.45035438500275188;0.75411150030827045 0.47470975909788871 7.0881522259502825;-1.5150351074065587 0.96309802608071648 -0.15548531967294696];

% Layer 2
b2 = [1.6915845941775935;-2.2342798314075587;-4.1058725940050183];
LW2_1 = [17.335314384831964 -0.1266754322821074 -3.2538588548501828 9.2954437861806642 -0.11732011291503103 -17.904705776767234 1.2987909096564441 -3.365306141240453 -3.1845063760669632 0.58316279865436882 -0.045914069700497759 -20.691910188230906 -0.60970678617170893 15.000602120907732 -7.6414435151945321 7.7028770215867448 -0.90050683376416629 -4.3120654851541085 -0.32453794365159694 -12.539160164259343 3.1087109724097366 -8.3119270101335125 -2.7877758083155273 7.994318635090667 0.71543565524165087 9.7505411617457884 3.9937109084417277 23.103014470702185 -4.3436876036897569 -3.8235004554139698 0.018026362284872983 5.6518116720072973 4.924577459990866 3.9185536012636462 -4.1891997171154456 -7.7310601425423737 -0.84220394231298445 1.8457971251749115 -4.1140584496867687 -0.54435335916668837 -3.8897440044008005 8.2611146124254979 1.3926266441286299 -1.7727205579270877 2.8730650038705847 6.62606929122094 1.5770598629995547 -1.9198893946720923 5.2435843898634547 -2.0256342223105031;-0.1052561581205998 0.031685322522514756 -0.030556673925383925 -0.58896145812621303 -0.061714257898671569 0.4918399744825882 0.54183302631098862 -0.024535523833115649 0.074623883370790317 0.21995127227941838 0.0026740628667059983 2.4742980169606965 -0.395765503372767 -3.9091790754945595 0.6251182925434734 0.39227239478273268 1.0304317669888126 1.9583861021202056 -0.20762311510270992 0.038617111769221162 -3.3801906267212201 -1.3284335876339552 0.45414970482125233 1.0754803539368269 -0.52160262178986028 -1.4196147580179035 -2.6379586908977339 -5.5842928124318432 5.0809715476028607 2.2984659820038886 -0.0083235138205655333 3.2878542666579396 -0.32865915343163787 -0.34106676807687281 -0.24238622512464905 0.53023388095053725 0.17304360373697192 0.086400995145163043 -0.13641928030180797 -0.073720862245763991 -0.5040302573896891 -0.21967301246924784 -4.5829911401415231 -0.95735628816330165 1.4528715775199843 2.3601216680014758 -0.28855684009310695 -1.2603276934658814 1.3448731433408161 -0.97404693909510642;3.0804304455117695 0.049819653050432608 1.6297139989677418 1.5318580053224948 0.28812753211451803 4.432942087076893 -2.7413328302845286 1.0937606465044425 1.5910312567384615 0.16582587922206971 0.05132175570788064 1.0365926930835387 1.0680453705090338 7.4243024389977617 1.7691687000730938 -5.4882365404644258 -4.2353483690505644 -6.829301057686215 -0.76571575425049543 6.6352160801864999 8.4210798084706173 9.4014798164529587 2.255611768400636 1.1638987245207395 0.85348275820282249 -0.20855930610086409 5.277252023837578 4.7842765808891432 -9.7202074978389437 -4.4183323988343641 -0.0048904718559985919 -5.6168100156559406 0.45656800198934355 0.018902062629099704 -6.6630215013029943 -1.9769811720514412 -1.2936581585046594 -0.010573006573531897 1.903468166668925 -0.83162364562160429 1.7195387298390155 -2.194934141612495 15.1957584673198 4.1854262776088991 -3.7762841674679568 -5.5321533188456966 -0.03130403644861033 3.1715680401151096 -7.5348386428680394 3.2109899935679547];

% Output 1
y1_step1.ymin = -1;
y1_step1.gain = [0.314491940119996;3.4632367725554;3.25539494941338];
y1_step1.xoffset = [-3.1797317273646;-0.288747222807447;-0.307182389706724];

% ===== SIMULATION ========

% Dimensions
Q = size(x1,2); % samples

% Input 1
xp1 = removeconstantrows_apply(x1,x1_step1);
xp1 = mapminmax_apply(xp1,x1_step2);

% Layer 1
a1 = tansig_apply(repmat(b1,1,Q) + IW1_1*xp1);

% Layer 2
a2 = repmat(b2,1,Q) + LW2_1*a1;

% Output 1
y1 = mapminmax_reverse(a2,y1_step1);
end

% ===== MODULE FUNCTIONS ========

% Map Minimum and Maximum Input Processing Function
function y = mapminmax_apply(x,settings)
  y = bsxfun(@minus,x,settings.xoffset);
  y = bsxfun(@times,y,settings.gain);
  y = bsxfun(@plus,y,settings.ymin);
end

% Remove Constants Input Processing Function
function y = removeconstantrows_apply(x,settings)
  y = x(settings.keep,:);
end

% Sigmoid Symmetric Transfer Function
function a = tansig_apply(n,~)
  a = 2 ./ (1 + exp(-2*n)) - 1;
end

% Map Minimum and Maximum Output Reverse-Processing Function
function x = mapminmax_reverse(y,settings)
  x = bsxfun(@minus,y,settings.ymin);
  x = bsxfun(@rdivide,x,settings.gain);
  x = bsxfun(@plus,x,settings.xoffset);
end
