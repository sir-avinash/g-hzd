function [y1] = nnEquLibrary2_raw180817(x1)
%NNEQULIBRARY2_RAW180817 neural network simulation function.
%
% Generated by Neural Network Toolbox function genFunction, 18-Aug-2017 21:24:37.
% 
% [y1] = nnEquLibrary2_raw180817(x1) takes these arguments:
%   x = 4xQ matrix, input #1
% and returns:
%   y = 3xQ matrix, output #1
% where Q is the number of samples.

%#ok<*RPMT0>

% ===== NEURAL NETWORK CONSTANTS =====

% Input 1
x1_step1.keep = [1 2 3];
x1_step2.xoffset = [-1.4251526730634;-1.04084247194734;0];
x1_step2.gain = [0.701679208761878;0.960760179327683;1];
x1_step2.ymin = -1;

% Layer 1
b1 = [0.29295726727755561;-0.35002820904054488;0.497741668084561;-8.3120953942131948;4.9539084158421183;-0.018468375182280932;2.1087226946913682;1.2236257962043906;-1.2498587893048949;-2.0297234577843124;7.1969017738528489;-1.2339986817540283;6.6922887869087369;-0.92551571830481383;16.17400767935986;5.426964620021729;23.582269707656511;0.90253508869476118;4.2988668437618598;1.2809504684127921;-3.0005987659507727;1.2155608415495813;12.830230235979585;8.9080569690763749;4.7821821369378199;0.19138572246281763;-2.5370512658348474;5.5536467368293527;-0.16253736110061284;1.1773630912958928;1.1103489298408755;-0.44967480851681979;-8.4386445763200548;0.52100871013832384;0.46370812250881827;-18.913498060015687;-0.2297254444791994;-5.7153036030650766;2.7434529151330862;0.84232883961126181;4.8312076312104821;-2.9373690611672321;13.024168041516866;10.415336636543952;3.1387896901467518;-1.3126866373913959;0.23678751215276109;4.0873850359804216;-1.2187254716468174;0.31478588056097118];
IW1_1 = [0.10155807991131073 -0.0063677576423057285 1.306261265057588;-0.61296186976871336 -0.30742794718509669 -0.65210086493305708;-0.071494465522284792 -0.36340798949258962 1.6964118667225681;-0.31849088977337742 -0.26036612407288662 -7.8362424960530888;-0.0065704869087433596 0.0029689615388501134 5.3495873445307884;-0.56344604890522743 -0.30369681388835379 -0.11955819885300545;-0.61545762251076597 -0.4702379080268822 -2.5185980762841385;0.14289149449591843 -0.40016871026449846 1.6382333572625674;0.44210812294668045 0.24756714777694808 -1.396006213667158;-0.029051016306866677 0.61249613379724743 -1.4514496912234338;-0.25521687924194381 -0.20572006288538769 7.1066820566034306;-0.67237288072466928 -0.51373678679147061 1.6341981406342412;0.011257731926311526 0.87599044617408028 -6.6243294906298704;-0.61061001288702177 -0.35604364324431342 0.65080013384823798;0.00066201939785883097 -0.76195545973256373 -15.829110788248016;-0.0658812709172341 0.98603023325790984 -4.9521785806060237;0.24145356627353623 1.2756134283810714 -24.299934086884903;-0.64978085264943852 -0.069894452349156339 -0.1490771947548542;0.39572798994223768 0.22309808110864507 3.9818697017675393;-0.72238524110457469 -0.32643044637298479 -1.4936601588521703;-0.41810230557705258 0.16015618778965923 3.6061730617438927;-0.82022212445292908 -0.40477817265157218 -0.91742884566000127;-0.2960686888368112 -0.14827422109915983 12.501435064291552;-0.31619211712370354 -0.21417286236044408 9.4350833216616738;-0.20441076224251983 -2.661899677825907 0.65645229097955371;0.58880206789718048 -0.026603249268458248 -0.14651893098123944;0.48511732678799846 -0.39280825101545702 -2.7354946056352381;-0.23248146781369403 -0.48642508025417225 -5.4608898114361955;-0.042929260686290625 -1.342559220844864 0.65523457531138207;-0.68467046024586131 -0.35391571745354239 0.55044008250697984;0.38215225763687322 -0.048020566426863615 -1.1784400267772366;0.62785901738376304 0.22830233609953438 1.4005478557494555;0.25308321223162344 0.18197382741309309 -8.8055757822972609;-0.53986470841169543 -0.023243084241224923 -0.69338715658062178;0.62263668696687002 -0.021718668257310829 0.18751702398547612;0.07204600153898455 0.79201626009003712 18.976374456976153;-0.30103582581035887 -0.25792200480879163 1.0291778671948553;0.022356284960242744 0.42520453815108433 5.9645755677516652;0.1495400569307164 -0.32151319357322061 2.5284516809808135;0.014560780666731166 -0.76156540869953093 0.64152992242482243;0.15508603476847199 0.073480192687528242 4.8535699115515971;-0.50257710859712368 -1.0438362406821118 -1.3034912564154468;0.036779039936066842 -0.26525137057480264 12.032913540547053;0.36604372478920244 0.150017559165363 10.001996069722518;0.57168791970663513 0.77060682031157723 -3.3284954157498108;0.0059073897798048742 -1.3107696600708303 1.1308745440874579;-0.093546493290058805 -0.013731753548663485 1.5327311048523209;0.54589952358886162 1.5551666802631441 -4.9262024681706276;-0.30978960331584682 0.22839325812045611 -1.9121775127760854;0.087071170602154441 1.0856010388909663 -0.28140815631664545];

% Layer 2
b2 = [-2.7173729776921807;-1.2429636126288877;2.0977957621020913];
LW2_1 = [5.3653833316952806 -2.5612379679408885 -0.22260799358829431 3.5353317328136025 -6.4930614669563678 5.3881780531820977 -0.74016716644009961 0.8154524386409252 2.1790474525144337 0.63207315400923481 8.2585011083628928 -0.43600629039850364 2.4241491305767973 2.6592981494967765 9.8568731308186681 -0.85019042949893397 0.92572307884053395 -3.7877223997319143 -5.1760078977518491 -3.9908016128886143 -0.58250154260520159 4.2272016640500354 -4.5956355955951782 1.011158746154694 -0.74387217024943231 2.7934845872290111 0.083699622856282963 -8.8915887645772109 -0.16561456406348174 1.6607610246343367 3.1439189289196778 2.182738345734236 5.6903196004864567 4.6078573538130749 -2.0321637584434562 6.8282818850937606 -1.817005313049378 -3.9793188320229675 1.3062898235078042 -0.99124511065183973 13.22620319957803 -0.52143654844894649 0.74997622393698182 3.8503505750421607 -0.93028936239930582 -0.30882011616430205 -2.6434211349095662 0.27406162099805809 0.2247331497594921 -0.022979299394085217;5.03563619556002 0.67977806507626026 -0.49243021774090079 0.8873569996708931 -0.14770666558825976 0.4284637873154169 -0.88694427034231171 -1.8305563230271764 1.5512470760794259 0.88902712190393407 -0.31100693405524438 -0.95725409090897906 -1.8219484013449818 -1.5123007090011682 0.38794519837312758 1.593099960670586 0.044661361520886581 0.42643904992394599 -0.14854913115139259 0.17658161794188651 -0.8294732693495126 -0.71687084157038339 -1.0473778954783211 -1.8775016068205264 0.3628115427487752 -1.1282309058041862 -0.19193674770504712 1.1969399990844529 -0.31698731521874679 -0.2931136751605215 -1.7228347176515357 0.46326660507009065 -2.8469908427572985 0.8255535053481996 0.061410858603746968 0.31937791322921238 -1.1708937764653546 -0.18263181332692899 1.3017280256761932 0.30164590400259711 0.012370673804008882 0.69425759608414228 2.4945882859795168 -0.022955520124098051 -0.34454242623995007 -0.25621765001927604 -2.2657554065542502 -0.42853427623319729 -1.4734588918824023 -0.46030175816497243;-5.5774756747550569 0.68822664583178284 1.297877509084298 -2.3171034034490439 3.9738085909860446 -1.1732840621111487 0.64221540205418493 3.0121732655337947 -2.1668562756062175 -2.9903442353155456 -5.3068041535824957 2.9484858074899685 -2.5327271692440125 -3.8691061725955236 0.53851680280542169 6.0676357731034827 0.10541677045552761 -5.1998645842624098 2.3735310795206082 0.2007220676819064 -0.73884725013241492 1.481072841630753 4.6528910777810637 2.3171841933705113 -1.656274218670116 3.1371384968655041 0.11941709488755774 -0.39047258801502577 -2.1926924897287425 0.67657872052604162 3.0869762921430115 -0.74903229496780477 0.71202886494943918 0.45538764618558336 -0.50542928584266156 0.63193579094606234 7.9223606486046299 -0.6386562014468804 -2.8935833768027965 -4.1275727465118726 -6.3791472399045039 0.12855093043116025 -4.0406392563221223 -1.7619341413099763 -3.9121848636375094 -2.5387420486314944 1.1115058574925549 0.19200332080554655 1.8723687692381263 -2.7581245703317032];

% Output 1
y1_step1.ymin = -1;
y1_step1.gain = [0.106697763396278;4.51171084124705;0.845880561664693];
y1_step1.xoffset = [-9.37226768555566;-0.221645410175178;-1.1822];

% ===== SIMULATION ========

% Dimensions
Q = size(x1,2); % samples

% Input 1
xp1 = removeconstantrows_apply(x1,x1_step1);
xp1 = mapminmax_apply(xp1,x1_step2);

% Layer 1
a1 = tansig_apply(repmat(b1,1,Q) + IW1_1*xp1);

% Layer 2
a2 = repmat(b2,1,Q) + LW2_1*a1;

% Output 1
y1 = mapminmax_reverse(a2,y1_step1);
end

% ===== MODULE FUNCTIONS ========

% Map Minimum and Maximum Input Processing Function
function y = mapminmax_apply(x,settings)
  y = bsxfun(@minus,x,settings.xoffset);
  y = bsxfun(@times,y,settings.gain);
  y = bsxfun(@plus,y,settings.ymin);
end

% Remove Constants Input Processing Function
function y = removeconstantrows_apply(x,settings)
  y = x(settings.keep,:);
end

% Sigmoid Symmetric Transfer Function
function a = tansig_apply(n,~)
  a = 2 ./ (1 + exp(-2*n)) - 1;
end

% Map Minimum and Maximum Output Reverse-Processing Function
function x = mapminmax_reverse(y,settings)
  x = bsxfun(@minus,y,settings.ymin);
  x = bsxfun(@rdivide,x,settings.gain);
  x = bsxfun(@plus,x,settings.xoffset);
end
