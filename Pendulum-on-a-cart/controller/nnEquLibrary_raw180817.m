function [y1] = nnEquLibrary_raw180817(x1)
%NNEQULIBRARY_RAW180817 neural network simulation function.
%
% Generated by Neural Network Toolbox function genFunction, 18-Aug-2017 21:26:52.
% 
% [y1] = nnEquLibrary_raw180817(x1) takes these arguments:
%   x = 4xQ matrix, input #1
% and returns:
%   y = 3xQ matrix, output #1
% where Q is the number of samples.

%#ok<*RPMT0>

% ===== NEURAL NETWORK CONSTANTS =====

% Input 1
x1_step1.keep = [1 2 3];
x1_step2.xoffset = [-7.17242193870723;-3.1356477374161;0];
x1_step2.gain = [0.13942291858254;0.318913374122835;1];
x1_step2.ymin = -1;

% Layer 1
b1 = [-1.4783194138493716;0.01976902227374043;1.7341480713945914;-0.72538570306115047;1.5150663277461935;0.64428865162808613;-0.51686733805269736;0.83217365782680408;-2.9495764843363377;0.074493355724639873;2.0063817151830312;-0.34531135920743655;17.148981211938281;1.5987236509882341;-3.8614150461909378;7.3687905742623094;-4.948762993748355;-1.3545936774960534;-0.69856747008473474;-6.7487116955306972;3.2792798723772978;10.719297433497928;-18.327036499393525;-1.3630734223165692;-8.3238642823673779;-7.8133313859389437;-0.26481599816642704;2.1907192254889165;-0.54426070315689756;-10.208902018490697;-0.49624995908364683;-3.7287950597806283;-0.28481624844582221;5.5568610961794196;-12.035130585469307;1.8974564801558809;-1.2326728257725053;0.91326141646691084;-0.56534549109630339;-3.487643487113274;0.013190373641505392;8.9799769475848237;-1.0772996350476614;-2.9401229511692639;-0.52078441204801296;-0.75136479147578361;-12.656570115993024;1.6773547871689536;0.01347901796824962;15.761594068797574];
IW1_1 = [-0.84559898451639082 -0.66191824865342552 1.8992046077681151;1.5396055062887519 0.63121372704575496 -0.55304681755399543;-1.2368439803106672 -1.3790365219743805 -0.91842778772217659;-0.69788356944564511 0.24027995473236965 -1.0055774430116764;0.63619634686436266 0.28542908104046333 -2.1779017945425712;-1.7023522548099241 -0.53877870017761642 1.220847396275919;0.70219280483235003 0.77907420999061028 1.7485218140804051;0.96651053948047638 0.90270628727063507 1.0959762729631268;-2.9883694487854884 -1.2662113250361269 -2.1084097038945702;-1.4642703995950641 -1.3043395998587273 0.52518483205780842;-3.1209683697174668 -1.9927363482738849 0.37773998098744743;-0.19530450358641824 0.21093996202606338 -1.81814302658065;-0.08215457735495528 -0.3255398701054788 -17.316919498217011;0.66566626688150532 0.63093498425747352 2.1997562607296177;0.083745142264681882 0.24646637038953481 -4.4266983207876427;-4.8925215313923722 -3.3598242142818533 4.2836237037847456;1.4166912189742566 -1.4869081026358917 -4.5717303397855797;-1.4842401875834585 -0.50441233579279887 -0.89125963022136456;0.36812127111642984 0.46358839062183205 0.020101145087771655;-0.7579852823313451 -0.17768402198375235 -6.6687886761607222;0.55099469933027667 0.85718533424230314 3.7914630392712638;-1.0264041357651901 0.075210080271689697 10.570069138419482;-0.091151728021979031 -0.364596153726786 18.612547799052418;-0.45061079714012342 -0.68752180604247537 0.89701468128221817;-0.43028437893716742 -0.80763559574974308 7.3738660096576005;3.7353441052847827 2.1743183362840939 -5.820178597894496;-0.70897388371956849 0.12489495341111852 -0.0083184546193737132;-3.9026796887463355 -2.5869842412488944 0.11745556915976202;-0.52924237961627774 -0.10935904429736117 -1.7957620168902646;0.061035255769150018 0.2904381485658023 9.8967463922100851;0.78076621551031988 0.58129744181295651 2.0271089716400232;0.63615145289950725 0.44394372378363417 -3.9312825869008585;1.5154392504655698 0.73104006021360901 -0.27210295583862915;1.8070744521372966 0.88063922001580286 5.0696228657498521;-0.247015123167519 -0.71704762752906914 11.365625478045498;-0.22784294300276114 0.3036108989980173 2.7331765491435434;1.1290219188690132 0.9276713574981742 1.0513286379678797;-0.83653511533684932 -0.41409176116849783 -0.9796655526248661;-1.1439280635507121 -0.051166893560196026 0.030563235618444963;-0.051697681637301984 -0.63029227711650204 -4.1467240242290062;-1.4063279929906567 -1.3079055387089948 -0.0059575055033414571;-0.040742817047792756 -0.31621775559690346 -9.1723307181534484;0.059452721382886008 -0.46036385044082562 1.4255920350308429;-2.4899447604335614 -0.92617512769222154 -2.5597850087821583;0.74673463571042542 0.32268255518381384 -1.5254641029588412;0.1175691486835624 -0.21289163706436709 -1.7226177342779536;-0.3176975847196073 -0.44882876089570695 -12.065296992657737;-1.2334121590779776 -0.29528454454028952 1.9411582416833193;1.6067219768834919 1.379862301655751 0.32282089801902936;0.96772808914011388 0.2739342312610899 15.452122557676171];

% Layer 2
b2 = [-1.0052033450090097;0.85447854776848775;-2.8546395130306341];
LW2_1 = [1.5136567125579421 1.6551567465707042 -1.1685581271198318 -0.25929435802954642 1.1582664824834974 -0.68766781734587057 0.71618873977236241 -1.1189589897271781 -1.7435906785188946 1.0007217760516285 2.0579460051158156 -0.56986686444456791 -4.8536098238627199 -2.8697997109489704 -3.2353261711953345 4.9074523950369029 -0.21980100088355389 -0.6427390256071932 0.085157817504946817 -7.0944727650762847 -3.3601017434177667 -1.0404719797689803 -2.8633122482779449 -1.4138094784818478 -5.4266981330924553 4.7584429874945435 0.65878768450261505 -0.8470966614559855 1.2030123812688183 -9.1859880780238576 -0.4463682945120851 5.0264002424123264 -2.0508692177470516 -6.1176722426106025 5.2734952496483301 3.8641281170720836 -1.7780979668043133 -1.6161992483666334 -0.40026496131213346 -3.463656894865248 -2.9054345409534421 -3.0124148075392991 0.28608381522429599 2.1073921395862221 1.1008681777909788 -3.8382192390191969 4.7636413809165816 -3.9790610810900486 -1.9337432169980835 3.2020597007295701;-1.319903637525748 -0.84660618475627014 1.1774047406743466 0.051764306024744244 -0.38467864048924572 1.0636307699806455 1.0259215527963998 0.66524240827001702 -1.3454114626341125 -1.0469742407170741 -0.96702708000168325 -0.68206249237871563 -0.33490499803693147 0.99622385823815518 1.031826825466871 -0.025649787853093079 -0.056633931842884136 0.28324061303025122 -0.84936025041257956 -0.064932286844947673 -0.6811330797520686 0.95226796977813688 -0.060103224724462639 2.7170080268883008 -0.84220848821738148 -0.95077814698680951 0.91441121741852238 0.045713445988357387 -0.47710289039806875 -0.27625054551542438 -1.0580652856375095 -1.2536553858038306 0.64940561974311661 -1.0922615055832032 -0.42309448241072473 -0.43397685581910983 -0.4337660054968393 -1.5060353391325818 -0.034916591574726139 -0.52506293782473357 0.73170223964681347 -0.18725982990409926 -0.47690371553068162 -0.10266031556826063 1.1752113576174896 1.8084811228154414 5.1820118578871055 0.19068915254631175 0.62882589812135148 2.2604361642617787;1.3577395382797053 1.1547833106168719 -1.7998288515314276 -1.5191352691811009 1.4828409838156158 -0.99007768420045528 2.2725261072464811 1.8368835289216712 -0.053915496115470682 0.26879652953179828 -1.7560017266479391 -0.29501610276281631 -0.11686856160354819 0.40966501803838978 0.073220384759951768 -2.9208942023193676 -0.08634860279642409 2.1777224126764532 -0.031796060604517125 3.5819789576887042 2.9045989593383128 -0.32014671058784372 -0.25178334250734519 0.18366198520082214 -2.2939756174890134 -0.9756061824152521 -1.8831563606986323 1.110987173147358 2.4511552691010103 0.8603791024575429 -1.7486806133070749 -0.23554529208935418 -1.8940712167099707 3.9792362711984017 0.41862703308508065 -1.4787382385505448 -0.26270343175492167 1.8520915989621574 0.77214735504935139 2.6459768140016404 -0.11408107139601972 0.078141130097108394 0.58413009122918957 0.42016341915775635 -1.5511647993819966 -0.23272665683669144 -9.2676181453346249 1.4615284989901172 0.29503640785965929 -4.8998494507265891];

% Output 1
y1_step1.ymin = -1;
y1_step1.gain = [0.106697763396278;4.51171084124705;0.845880561664693];
y1_step1.xoffset = [-9.37226768555566;-0.221645410175178;-1.1822];

% ===== SIMULATION ========

% Dimensions
Q = size(x1,2); % samples

% Input 1
xp1 = removeconstantrows_apply(x1,x1_step1);
xp1 = mapminmax_apply(xp1,x1_step2);

% Layer 1
a1 = tansig_apply(repmat(b1,1,Q) + IW1_1*xp1);

% Layer 2
a2 = repmat(b2,1,Q) + LW2_1*a1;

% Output 1
y1 = mapminmax_reverse(a2,y1_step1);
end

% ===== MODULE FUNCTIONS ========

% Map Minimum and Maximum Input Processing Function
function y = mapminmax_apply(x,settings)
  y = bsxfun(@minus,x,settings.xoffset);
  y = bsxfun(@times,y,settings.gain);
  y = bsxfun(@plus,y,settings.ymin);
end

% Remove Constants Input Processing Function
function y = removeconstantrows_apply(x,settings)
  y = x(settings.keep,:);
end

% Sigmoid Symmetric Transfer Function
function a = tansig_apply(n,~)
  a = 2 ./ (1 + exp(-2*n)) - 1;
end

% Map Minimum and Maximum Output Reverse-Processing Function
function x = mapminmax_reverse(y,settings)
  x = bsxfun(@minus,y,settings.ymin);
  x = bsxfun(@rdivide,x,settings.gain);
  x = bsxfun(@plus,x,settings.xoffset);
end
